<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>debounce-throttle Demo</title>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: "Space Grotesk", "Trebuchet MS", Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 2rem;
      background: #f5f5f5;
    }

    h1 {
      color: #333;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: #666;
      margin-bottom: 2rem;
    }

    .top-links {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    .top-links a {
      font-size: 0.8rem;
      color: #555;
      text-decoration: none;
      border: 1px solid #ddd;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
    }

    .section {
      background: white;
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .section h2 {
      margin: 0 0 1rem;
      color: #333;
      font-size: 1.25rem;
    }

    .demo-row {
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 1rem;
      align-items: start;
      margin-bottom: 1rem;
    }

    .demo-controls {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .demo-controls label {
      font-size: 0.875rem;
      color: #666;
    }

    .demo-controls input[type="range"] {
      width: 100%;
    }

    .demo-controls input[type="text"] {
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 100%;
    }

    .event-log {
      background: #1e1e1e;
      color: #d4d4d4;
      border-radius: 4px;
      padding: 1rem;
      font-family: monospace;
      font-size: 0.875rem;
      height: 150px;
      overflow-y: auto;
    }

    .event-log .raw {
      color: #f14c4c;
    }

    .event-log .processed {
      color: #4ec9b0;
    }

    .event-log .time {
      color: #888;
    }

    .stats {
      display: flex;
      gap: 2rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid #eee;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #333;
    }

    .stat-label {
      font-size: 0.75rem;
      color: #666;
      text-transform: uppercase;
    }

    .stat-value.raw {
      color: #f14c4c;
    }

    .stat-value.processed {
      color: #4ec9b0;
    }

    button {
      padding: 0.5rem 1rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.875rem;
    }

    button:hover {
      background: #0056b3;
    }

    .button-group {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .scroll-area {
      height: 100px;
      overflow-y: auto;
      background: #f8f8f8;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 1rem;
    }

    .scroll-content {
      height: 500px;
      background: linear-gradient(to bottom, #e3f2fd, #bbdefb, #90caf9, #64b5f6, #42a5f5);
    }

    .resize-area {
      resize: both;
      overflow: auto;
      min-width: 200px;
      min-height: 80px;
      max-width: 100%;
      background: #f8f8f8;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
    }

    .code-block {
      background: #0b0f1a;
      border: 1px solid #2b3247;
      border-radius: 8px;
      padding: 12px;
      color: #d6d9e6;
      font-family: "JetBrains Mono", "Courier New", monospace;
      font-size: 0.85rem;
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <div class="top-links">
    <a href="https://manufosela.github.io/utils/">Utils catalog</a>
    <a href="https://manufosela.github.io/">Main catalog</a>
    <a href="https://github.com/manufosela/utils/tree/main/packages/debounce-throttle">Source</a>
  </div>
  <h1>debounce-throttle</h1>
  <p class="subtitle">Debounce, throttle, and rate-limit utilities in action.</p>

  <div class="section">
    <h2>Quick usage</h2>
    <pre class="code-block"><code>import { debounce, throttle } from '@manufosela/debounce-throttle';

const debounced = debounce(onInput, 300);
const throttled = throttle(onScroll, 200);
</code></pre>
  </div>

  <!-- Debounce Demo -->
  <div class="section">
    <h2>Debounce - Search Input</h2>
    <p style="color: #666; font-size: 0.875rem; margin-bottom: 1rem;">
      Type in the input and see how debounce delays the API call until you stop typing.
    </p>
    <div class="demo-row">
      <div class="demo-controls">
        <label>Delay: <span id="debounceDelayValue">300</span>ms</label>
        <input type="range" id="debounceDelay" min="100" max="1000" value="300" step="100">
        <input type="text" id="searchInput" placeholder="Type to search...">
      </div>
      <div class="event-log" id="debounceLog"></div>
    </div>
    <div class="stats">
      <div class="stat">
        <div class="stat-value raw" id="debounceRawCount">0</div>
        <div class="stat-label">Keystrokes</div>
      </div>
      <div class="stat">
        <div class="stat-value processed" id="debounceProcessedCount">0</div>
        <div class="stat-label">API Calls</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="debounceSavings">0%</div>
        <div class="stat-label">Calls Saved</div>
      </div>
    </div>
  </div>

  <!-- Throttle Demo -->
  <div class="section">
    <h2>Throttle - Scroll Handler</h2>
    <p style="color: #666; font-size: 0.875rem; margin-bottom: 1rem;">
      Scroll inside the box and see how throttle limits the handler calls.
    </p>
    <div class="demo-row">
      <div class="demo-controls">
        <label>Limit: <span id="throttleLimitValue">100</span>ms</label>
        <input type="range" id="throttleLimit" min="50" max="500" value="100" step="50">
        <div class="scroll-area" id="scrollArea">
          <div class="scroll-content"></div>
        </div>
      </div>
      <div class="event-log" id="throttleLog"></div>
    </div>
    <div class="stats">
      <div class="stat">
        <div class="stat-value raw" id="throttleRawCount">0</div>
        <div class="stat-label">Scroll Events</div>
      </div>
      <div class="stat">
        <div class="stat-value processed" id="throttleProcessedCount">0</div>
        <div class="stat-label">Handler Calls</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="throttleSavings">0%</div>
        <div class="stat-label">Calls Saved</div>
      </div>
    </div>
  </div>

  <!-- Once Demo -->
  <div class="section">
    <h2>Once - Single Initialization</h2>
    <p style="color: #666; font-size: 0.875rem; margin-bottom: 1rem;">
      Click the button multiple times - the function only executes once.
    </p>
    <div class="button-group">
      <button id="onceButton">Initialize (click multiple times)</button>
      <button id="onceReset">Reset</button>
    </div>
    <div class="event-log" id="onceLog" style="height: 100px; margin-top: 1rem;"></div>
  </div>

  <!-- Rate Limit Demo -->
  <div class="section">
    <h2>Rate Limit - API Calls</h2>
    <p style="color: #666; font-size: 0.875rem; margin-bottom: 1rem;">
      Limited to 5 calls per 3 seconds. Click rapidly to see rate limiting in action.
    </p>
    <div class="button-group">
      <button id="rateLimitButton">Call API</button>
    </div>
    <div class="event-log" id="rateLimitLog" style="height: 150px; margin-top: 1rem;"></div>
    <div class="stats">
      <div class="stat">
        <div class="stat-value raw" id="rateLimitAttempts">0</div>
        <div class="stat-label">Attempts</div>
      </div>
      <div class="stat">
        <div class="stat-value processed" id="rateLimitSuccess">0</div>
        <div class="stat-label">Successful</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="rateLimitBlocked">0</div>
        <div class="stat-label">Blocked</div>
      </div>
    </div>
  </div>

  <script type="module">
    import { debounce, throttle, once, rateLimit } from '../src/index.js';

    // Helper to format time
    function formatTime() {
      const now = new Date();
      return `${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}.${now.getMilliseconds().toString().padStart(3, '0')}`;
    }

    // Helper to add log entry
    function addLog(logId, message, type = 'raw') {
      const log = document.getElementById(logId);
      const entry = document.createElement('div');
      entry.innerHTML = `<span class="time">[${formatTime()}]</span> <span class="${type}">${message}</span>`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;
    }

    // ============ Debounce Demo ============
    let debounceRawCount = 0;
    let debounceProcessedCount = 0;
    let currentDebouncedSearch;

    function createDebouncedSearch(delay) {
      return debounce((value) => {
        debounceProcessedCount++;
        document.getElementById('debounceProcessedCount').textContent = debounceProcessedCount;
        addLog('debounceLog', `API call with: "${value}"`, 'processed');
        updateDebounceSavings();
      }, delay);
    }

    currentDebouncedSearch = createDebouncedSearch(300);

    document.getElementById('searchInput').addEventListener('input', (e) => {
      debounceRawCount++;
      document.getElementById('debounceRawCount').textContent = debounceRawCount;
      addLog('debounceLog', `Keystroke: "${e.target.value}"`, 'raw');
      currentDebouncedSearch(e.target.value);
      updateDebounceSavings();
    });

    document.getElementById('debounceDelay').addEventListener('input', (e) => {
      document.getElementById('debounceDelayValue').textContent = e.target.value;
      currentDebouncedSearch.cancel();
      currentDebouncedSearch = createDebouncedSearch(parseInt(e.target.value));
    });

    function updateDebounceSavings() {
      const savings = debounceRawCount > 0
        ? Math.round((1 - debounceProcessedCount / debounceRawCount) * 100)
        : 0;
      document.getElementById('debounceSavings').textContent = `${savings}%`;
    }

    // ============ Throttle Demo ============
    let throttleRawCount = 0;
    let throttleProcessedCount = 0;
    let currentThrottledScroll;

    function createThrottledScroll(limit) {
      return throttle((scrollTop) => {
        throttleProcessedCount++;
        document.getElementById('throttleProcessedCount').textContent = throttleProcessedCount;
        addLog('throttleLog', `Handler: scrollTop = ${scrollTop}px`, 'processed');
        updateThrottleSavings();
      }, limit);
    }

    currentThrottledScroll = createThrottledScroll(100);

    document.getElementById('scrollArea').addEventListener('scroll', (e) => {
      throttleRawCount++;
      document.getElementById('throttleRawCount').textContent = throttleRawCount;
      addLog('throttleLog', `Scroll event: ${e.target.scrollTop}px`, 'raw');
      currentThrottledScroll(e.target.scrollTop);
      updateThrottleSavings();
    });

    document.getElementById('throttleLimit').addEventListener('input', (e) => {
      document.getElementById('throttleLimitValue').textContent = e.target.value;
      currentThrottledScroll.cancel();
      currentThrottledScroll = createThrottledScroll(parseInt(e.target.value));
    });

    function updateThrottleSavings() {
      const savings = throttleRawCount > 0
        ? Math.round((1 - throttleProcessedCount / throttleRawCount) * 100)
        : 0;
      document.getElementById('throttleSavings').textContent = `${savings}%`;
    }

    // ============ Once Demo ============
    let createOnceFunction;

    function setupOnceDemo() {
      createOnceFunction = once(() => {
        addLog('onceLog', 'Function executed! This only happens once.', 'processed');
        return 'initialized';
      });
    }

    setupOnceDemo();

    document.getElementById('onceButton').addEventListener('click', () => {
      addLog('onceLog', 'Button clicked', 'raw');
      const result = createOnceFunction();
      if (result) {
        addLog('onceLog', `Returned: "${result}"`, 'processed');
      }
    });

    document.getElementById('onceReset').addEventListener('click', () => {
      document.getElementById('onceLog').innerHTML = '';
      setupOnceDemo();
      addLog('onceLog', 'Demo reset', 'processed');
    });

    // ============ Rate Limit Demo ============
    let rateLimitAttempts = 0;
    let rateLimitSuccess = 0;
    let rateLimitBlocked = 0;

    const rateLimitedApi = rateLimit(() => {
      rateLimitSuccess++;
      document.getElementById('rateLimitSuccess').textContent = rateLimitSuccess;
      addLog('rateLimitLog', 'API call successful', 'processed');
      return true;
    }, 5, 3000);

    document.getElementById('rateLimitButton').addEventListener('click', () => {
      rateLimitAttempts++;
      document.getElementById('rateLimitAttempts').textContent = rateLimitAttempts;
      addLog('rateLimitLog', 'Attempting API call...', 'raw');

      const result = rateLimitedApi();
      if (result === undefined) {
        rateLimitBlocked++;
        document.getElementById('rateLimitBlocked').textContent = rateLimitBlocked;
        addLog('rateLimitLog', 'BLOCKED - Rate limit exceeded (5 per 3s)', 'raw');
      }
    });
  </script>
</body>
</html>
