<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Event Bus WebComponent Demo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap"
    rel="stylesheet"
  />
  <style>


* { box-sizing: border-box; }
    body {
      margin: 0;
      color: var(--text);
      background: radial-gradient(circle at 10% 10%, #1a2136, transparent 50%),
        radial-gradient(circle at 80% 0%, #1d1b34, transparent 45%),
        linear-gradient(180deg, var(--bg) 0%, var(--bg-panel) 100%);
      font-family: "Space Grotesk", "Trebuchet MS", Arial, sans-serif;
    }
    header {
      padding: 32px 24px 16px;
      border-bottom: 1px solid var(--border);
    }
    .container { max-width: 1100px; margin: 0 auto; }
    .top-links {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .top-links a {
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 12px;
      color: var(--text-muted);
      font-size: 0.85rem;
      text-decoration: none;
    }
    h1 { margin: 0; font-size: clamp(28px, 4vw, 44px); 
      color: var(--accent);
    }
    p { margin: 8px 0 0; color: var(--text-muted); }
    main { padding: 24px; }
    .grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    .card {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px;
      display: grid;
      gap: 10px;
    }
    .control-card {
      grid-column: 1 / -1;
      display: grid;
      gap: 16px;
    }
    .control-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 0.8rem;
    }
    label {
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    select, input[type="checkbox"] {
      accent-color: var(--accent);
    }
    select {
      background: var(--bg-panel);
      color: var(--text);
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 8px;
    }
    button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(120deg, var(--accent), #ff6a00);
      color: #111;
      cursor: pointer;
      font-weight: 600;
    }
    button.secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
    }
    .log {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      font-size: 0.85rem;
      height: 160px;
      overflow-y: auto;
    }
    .code-block {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      font-size: 0.85rem;
      color: #d6d9e6;
      white-space: pre-wrap;
    }
    footer {
      text-align: center;
      padding: 2rem 0 3rem;
      color: var(--text-muted);
    }
    footer a { color: var(--accent); text-decoration: none; }
  





</style>
  <link rel="stylesheet" href="../../demo-theme.css" />
</head>
<body>
  <header>
    <div class="container">
      <div class="top-links">
        <a href="https://manufosela.github.io/utils/">Utils catalog</a>
        <a href="https://manufosela.github.io/">Main catalog</a>
        <a href="https://github.com/manufosela/utils/tree/main/packages/event-bus-webcomponent">Source</a>
      </div>
        <demo-theme-toggle></demo-theme-toggle>
      <h1>Event Bus WebComponent</h1>
      <p>DOM CustomEvent bus with source/target envelopes and ALL broadcasts.</p>
    </div>
  </header>

  <main>
    <div class="container grid">
      <section class="card control-card">
        <h2>Send events</h2>
        <div class="control-row">
          <span class="pill">Sender</span>
          <select id="senderSelect">
            <option value="card-a">Component A</option>
            <option value="card-b">Component B</option>
            <option value="card-c">Component C</option>
            <option value="card-d">Component D</option>
          </select>
          <label>
            <input type="checkbox" id="excludeSelf" checked /> Broadcast: exclude sender
          </label>
        </div>
        <div class="control-row">
          <label>
            Event name
            <input type="text" id="eventNameInput" value="ping" />
          </label>
          <label style="flex: 1 1 320px;">
            Payload (JSON)
            <input type="text" id="payloadInput" value='{"note":"Hello"}' />
          </label>
        </div>
        <div class="control-row">
          <button data-target="card-a">Send to A</button>
          <button data-target="card-b">Send to B</button>
          <button data-target="card-c">Send to C</button>
          <button data-target="card-d">Send to D</button>
          <button class="secondary" data-group="bcd">Send to B+C+D</button>
          <button class="secondary" data-group="all">Broadcast ALL</button>
        </div>
        <div class="code-block">import { WebComponentEventBus, ALL, ALL_TYPES } from '@manufosela/event-bus-webcomponent';

const bus = new WebComponentEventBus();

bus.on({ id: 'card-b', type: 'demo-card' }, (envelope) => {
  console.log(envelope.name, envelope.detail);
});

bus.emit({
  name: 'ping',
  detail: { ok: true },
  source: { id: 'card-a', type: 'demo-card' },
  target: { id: ALL, type: ALL_TYPES, excludeSource: true }
});</div>
      </section>

      <section class="card">
        <h3>Component A (card-a)</h3>
        <div class="log" id="logA"></div>
      </section>
      <section class="card">
        <h3>Component B (card-b)</h3>
        <div class="log" id="logB"></div>
      </section>
      <section class="card">
        <h3>Component C (card-c)</h3>
        <div class="log" id="logC"></div>
      </section>
      <section class="card">
        <h3>Component D (card-d)</h3>
        <div class="log" id="logD"></div>
      </section>
    </div>
  </main>

  <footer>
    <p>Event bus demo Â· <a href="https://github.com/manufosela/utils">@manufosela</a></p>
  </footer>

  <script type="module">
    import { WebComponentEventBus, ALL, ALL_TYPES } from '../src/index.js';

    const bus = new WebComponentEventBus();

    const components = {
      'card-a': { id: 'card-a', type: 'demo-card' },
      'card-b': { id: 'card-b', type: 'demo-card' },
      'card-c': { id: 'card-c', type: 'demo-card' },
      'card-d': { id: 'card-d', type: 'demo-card' },
    };

    const logs = {
      'card-a': document.getElementById('logA'),
      'card-b': document.getElementById('logB'),
      'card-c': document.getElementById('logC'),
      'card-d': document.getElementById('logD'),
    };

    const log = (container, message) => {
      const entry = document.createElement('div');
      entry.textContent = message;
      container.prepend(entry);
    };

    Object.values(components).forEach((component) => {
      bus.on(component, (envelope) => {
        log(logs[component.id], `Received ${envelope.name} from ${envelope.source.id}`);
      });
    });

    const senderSelect = document.getElementById('senderSelect');
    const excludeSelf = document.getElementById('excludeSelf');
    const eventNameInput = document.getElementById('eventNameInput');
    const payloadInput = document.getElementById('payloadInput');

    const readPayload = () => {
      const raw = payloadInput.value.trim();
      if (!raw) {
        return {};
      }
      try {
        return JSON.parse(raw);
      } catch (error) {
        return { raw };
      }
    };

    const emitTo = (targetId) => {
      const sender = components[senderSelect.value];
      const target = components[targetId];
      bus.emit({
        name: eventNameInput.value.trim() || 'direct',
        detail: { to: targetId, ...readPayload() },
        source: sender,
        target,
      });
    };

    const emitGroup = (targets) => {
      const sender = components[senderSelect.value];
      targets.forEach((id) => {
        bus.emit({
          name: eventNameInput.value.trim() || 'group',
          detail: { to: id, ...readPayload() },
          source: sender,
          target: components[id],
        });
      });
    };

    const emitAll = () => {
      const sender = components[senderSelect.value];
      bus.emit({
        name: eventNameInput.value.trim() || 'broadcast',
        detail: { note: 'Hello all', ...readPayload() },
        source: sender,
        target: {
          id: ALL,
          type: ALL_TYPES,
          excludeSource: excludeSelf.checked,
        },
      });
    };

    document.querySelectorAll('button[data-target]').forEach((button) => {
      button.addEventListener('click', () => emitTo(button.dataset.target));
    });

    document.querySelectorAll('button[data-group]').forEach((button) => {
      button.addEventListener('click', () => {
        if (button.dataset.group === 'bcd') {
          emitGroup(['card-b', 'card-c', 'card-d']);
        }
        if (button.dataset.group === 'all') {
          emitAll();
        }
      });
    });
  </script>
  <script type="module" src="../../demo-theme-toggle.js"></script>
</body>
</html>
